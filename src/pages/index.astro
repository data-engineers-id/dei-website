---
import Layout from '../layouts/Layout.astro';
import LegoBatikSea from '../components/ui/LegoBatikSea.astro';
import { fetchMediumArticles, formatDate, extractExcerpt, extractFirstImage } from '../lib/medium';
import { getFeaturedEvents } from '../lib/supabase';

// Fetch data
const articles = await fetchMediumArticles(3);
const events = await getFeaturedEvents();

const siteConfig = {
  foundedYear: 2019,
  memberCount: 2000,
  yearsActive: new Date().getFullYear() - 2019,
};
---

<Layout>
  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-[#1e3a5f] via-[#2a4a73] to-[#152a45] text-white py-20 md:py-32 relative overflow-hidden">
    <!-- Lego Blocks with Batik Patterns Floating on Sea -->
    <LegoBatikSea />
    
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
      <h1 class="text-4xl md:text-6xl font-bold text-white mb-6 leading-tight">
        Empowering Indonesia's<br />Data Engineering Community
      </h1>
      <p class="text-xl md:text-2xl text-white mb-8 max-w-3xl mx-auto">
        Since 2019, we've been building a thriving community of data professionals through knowledge sharing, events, and collaboration.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="/events" class="btn-primary-light text-lg px-8 py-4">
          Explore Events
        </a>
        <a href="/articles" class="bg-white text-[#1e3a5f] font-semibold rounded-lg text-lg px-8 py-4 hover:bg-gray-100 transition-colors shadow-lg">
          Read Articles
        </a>
      </div>
      
      <!-- Social Proof -->
      <div class="mt-16 grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
        <div class="bg-white/10 rounded-lg p-6 backdrop-blur-sm">
          <div class="text-4xl font-bold text-white mb-2">{siteConfig.memberCount.toLocaleString()}+</div>
          <div class="text-white">Telegram Members</div>
        </div>
        <div class="bg-white/10 rounded-lg p-6 backdrop-blur-sm">
          <div class="text-4xl font-bold text-white mb-2">{siteConfig.yearsActive}+</div>
          <div class="text-white">Years Active</div>
        </div>
        <div class="bg-white/10 rounded-lg p-6 backdrop-blur-sm">
          <div class="text-4xl font-bold text-white mb-2">100+</div>
          <div class="text-white">Events & Workshops</div>
        </div>
      </div>
    </div>
  </section>

  <!-- About Preview Section -->
  <section class="section bg-white">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-6">Who We Are</h2>
        <p class="text-lg text-gray-600 mb-8">
          Data Engineering Indonesia (DEI) is a community-driven platform dedicated to advancing data engineering practices in Indonesia. We bring together professionals, enthusiasts, and learners to share knowledge and grow together.
        </p>
        <a href="/about" class="btn-secondary inline-block">
          Learn More About Us
        </a>
      </div>
    </div>
  </section>

  <!-- Featured Events Section -->
  <section class="section bg-gray-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold">Upcoming Events</h2>
        <a href="/events" class="text-[#1e3a5f] font-semibold hover:text-[#152a45] flex items-center">
          View All Events
          <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
      </div>

      {events.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {events.map((event) => (
            <article class="card overflow-hidden">
              <div class="aspect-video bg-gray-200 relative">
                {event.coverImage ? (
                  <img src={event.coverImage} alt={event.title} class="w-full h-full object-cover" />
                ) : (
                  <div class="w-full h-full flex items-center justify-center bg-[#1e3a5f]">
                    <span class="text-white font-semibold">DEI Event</span>
                  </div>
                )}
                <div class="absolute top-4 left-4">
                  <span class="bg-white px-3 py-1 rounded-full text-sm font-semibold text-[#1e3a5f]">
                    {event.category}
                  </span>
                </div>
              </div>
              <div class="p-6">
                <time class="text-sm text-gray-500">{formatDate(event.startDate.toISOString())}</time>
                <h3 class="text-xl font-bold mt-2 mb-3 text-[#1e3a5f]">{event.title}</h3>
                <p class="text-gray-600 mb-4 line-clamp-2">{event.excerpt}</p>
                <a href={`/events/${event.slug}`} class="text-[#1e3a5f] font-semibold hover:text-[#152a45] inline-flex items-center">
                  Learn More
                  <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </a>
              </div>
            </article>
          ))}
        </div>
      ) : (
        <div class="text-center py-12 bg-white rounded-lg shadow-sm">
          <p class="text-gray-600 mb-4">No upcoming events at the moment.</p>
          <a href="/events" class="btn-primary inline-block">
            View Past Events
          </a>
        </div>
      )}
    </div>
  </section>

  <!-- Latest Articles Section -->
  <section class="section bg-white">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold">Latest Articles</h2>
        <a href="/articles" class="text-[#1e3a5f] font-semibold hover:text-[#152a45] flex items-center">
          View All Articles
          <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
      </div>

      {articles.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {articles.map((article) => (
            <article class="card overflow-hidden">
              <div class="aspect-video bg-gray-200 relative">
                {extractFirstImage(article['content:encoded'] || '') ? (
                  <img 
                    src={extractFirstImage(article['content:encoded'] || '')} 
                    alt={article.title} 
                    class="w-full h-full object-cover"
                  />
                ) : (
                  <div class="w-full h-full flex items-center justify-center bg-[#1e3a5f]">
                    <span class="text-white font-semibold">DEI Article</span>
                  </div>
                )}
              </div>
              <div class="p-6">
                <div class="flex items-center justify-between text-sm text-gray-500 mb-2">
                  <span>{formatDate(article.pubDate)}</span>
                  <span>{article['dc:creator'] || 'DEI Team'}</span>
                </div>
                <h3 class="text-xl font-bold mb-3 text-[#1e3a5f] line-clamp-2">{article.title}</h3>
                <p class="text-gray-600 mb-4 line-clamp-3">
                  {extractExcerpt(article['content:encoded'] || '', 150)}
                </p>
                <a 
                  href={article.link} 
                  target="_blank" 
                  rel="noopener noreferrer"
                  class="text-[#1e3a5f] font-semibold hover:text-[#152a45] inline-flex items-center"
                >
                  Read on Medium
                  <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </a>
              </div>
            </article>
          ))}
        </div>
      ) : (
        <div class="text-center py-12 bg-gray-50 rounded-lg">
          <p class="text-gray-600">Unable to load articles at the moment.</p>
        </div>
      )}
    </div>
  </section>

  <!-- CTA Section -->
  <section class="section bg-[#1e3a5f] text-white">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-white mb-6">Join Our Community</h2>
      <p class="text-xl text-white mb-8 max-w-2xl mx-auto">
        Connect with {siteConfig.memberCount.toLocaleString()}+ data professionals, stay updated on events, and contribute to the growing data engineering ecosystem in Indonesia.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="https://t.me/dataengineeringindonesia" target="_blank" rel="noopener noreferrer" class="btn-primary-light bg-white text-[#1e3a5f] font-semibold rounded-lg text-lg px-8 py-4 hover:bg-gray-100 transition-colors shadow-lg">
          Join Telegram Group
        </a>
        <a href="/contact" class="bg-white text-[#1e3a5f] font-semibold rounded-lg text-lg px-8 py-4 hover:bg-gray-100 transition-colors shadow-lg">
          Get in Touch
        </a>
      </div>
    </div>
  </section>
</Layout>
